{% set urlParts = page.url.split('/') %}
{% set urlLang = "en" %}

{% if urlParts.length >= 3 and urlParts[1] == "stories" %}
  {% set urlLang = urlParts[2] %}
{% elif urlParts.length >= 2 and (urlParts[1] == "en" or urlParts[1] == "es") %}
  {% set urlLang = urlParts[1] %}
{% endif %}

{% set currentLang = urlLang %}
<!doctype html>
<html lang="{{ currentLang }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title or "Buenos Aires 2025" }}</title>
  <link rel="stylesheet" href="/assets/styles/index.css">
  <link rel="stylesheet" href="/assets/styles/override.css">
  <link rel="stylesheet" href="/assets/styles/aboutstyle.css">
  <style>
    .gradient-overlay::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      height: 200px;
      width: 100%;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0));
      z-index: 10;
      pointer-events: none;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen bg-white">

  <!-- Transparent nav -->
  <header class="absolute top-0 left-0 w-full z-50 bg-transparent text-white">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-6">

      <!-- Logo -->
  <a href="/{{ currentLang }}/" class="flex items-center">
  <img src="/assets/img/uploads/almas-logo-resize.svg" alt="Logo" class="h-16">
  </a>

      <!-- Navigation -->
      <nav aria-label="Main navigation">
        <ul class="flex space-x-6 text-base font-bold">
          {% if currentLang == "en" %}
            {% set menuStories = collections.storiesEN %}
          {% else %}
            {% set menuStories = collections.storiesES %}
          {% endif %}

          {% for story in menuStories %}
            <li>
              <a href="{{ story.url }}" class="hover:underline hover:text-gray-300">{{ story.data.title }}</a>
            </li>
          {% endfor %}
        </ul>
      </nav>

      <!-- About + Language Toggle -->
      <div class="flex items-center space-x-4 text-base font-bold">
        <a href="/{{ currentLang }}/about/" class="hover:underline">
          {% if currentLang == "en" %}About{% else %}Acerca de{% endif %}
        </a>

        {% if currentLang == "en" %}
          {% set otherLang = "es" %}
        {% else %}
          {% set otherLang = "en" %}
        {% endif %}
        {% set translatedUrl = "/" ~ otherLang ~ "/" %}

        {% if '/stories/' in page.url %}
          {% set urlSegments = page.url.split('/') %}
          {% set storySlug = urlSegments[urlSegments.length - 1] or urlSegments[urlSegments.length - 2] %}
          {% if storySlug == "" %}
            {% set storySlug = urlSegments[urlSegments.length - 2] %}
          {% endif %}
          {% if currentLang == "en" and collections.storiesES.length > 0 %}
            {% for story in collections.storiesES %}
              {% if story.data.translationKey == page.data.translationKey %}
                {% set translatedUrl = story.url %}
              {% endif %}
            {% endfor %}
          {% elif currentLang == "es" and collections.storiesEN.length > 0 %}
            {% for story in collections.storiesEN %}
              {% if story.data.translationKey == page.data.translationKey %}
                {% set translatedUrl = story.url %}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endif %}

        <div class="language-toggle rounded-full bg-gray-800 p-1 flex items-center">
          {% if currentLang == "en" %}
            <span class="toggle-option active py-1 px-3 rounded-full bg-white text-black font-bold">EN</span>
            <a href="{{ translatedUrl }}" class="toggle-option py-1 px-3 text-gray-300 hover:text-white hover:underline font-bold">ES</a>
          {% else %}
            <a href="{{ translatedUrl }}" class="toggle-option py-1 px-3 text-gray-300 hover:text-white hover:underline font-bold">EN</a>
            <span class="toggle-option active py-1 px-3 rounded-full bg-white text-black font-bold">ES</span>
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <!-- Content w/ gradient overlay -->
  <main class="flex-grow relative gradient-overlay">
    {{ content | safe }}
  </main>

  <!-- Footer -->
  <footer class="bg-[#8D926E] text-white py-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4">
      <div class="font-semibold">Logo</div>
      <ul class="flex space-x-6 text-sm">
        <li><a href="https://instagram.com" target="_blank" rel="noopener">Instagram</a></li>
        <li><a href="https://facebook.com" target="_blank" rel="noopener">Facebook</a></li>
        <li><a href="#">Blog</a></li>
        <li><a href="#" class="font-semibold">About Hussman</a></li>
      </ul>
    </div>
  </footer>

  <script src="/assets/js/lightsOut.js"></script>
</body>
</html>