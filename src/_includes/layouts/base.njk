{% set urlParts = page.url.split('/') %}
{% set urlLang = "en" %}

{% if urlParts.length >= 3 and urlParts[1] == "stories" %}
  {% set urlLang = urlParts[2] %}
{% elif urlParts.length >= 2 and (urlParts[1] == "en" or urlParts[1] == "es") %}
  {% set urlLang = urlParts[1] %}
{% endif %}

{% set currentLang = urlLang %}
<!doctype html>
<html lang="{{ currentLang }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title or "Buenos Aires 2025" }}</title>
  <link rel="stylesheet" href="/assets/styles/index.css">
  <link rel="stylesheet" href="/assets/styles/override.css">
  <link rel="stylesheet" href="/assets/styles/aboutstyle.css">
  <!-- additional head content -->
</head>
<body class="flex flex-col min-h-screen">
  <header class="bg-[#8D926E] text-white p-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between">

      <!-- Left: Logo - Link to current language home -->
      <a href="/{{ currentLang }}/" class="text-lg font-medium">Logo</a>

      <!-- Center: Navigation (Menu) - Use the correct language collection -->
      <nav aria-label="Main navigation">
        <ul class="flex space-x-6 text-sm">
          {% if currentLang == "en" %}
            {% set menuStories = collections.storiesEN %}
          {% else %}
            {% set menuStories = collections.storiesES %}
          {% endif %}
  
          {% for story in menuStories %}
            <li>
              <a href="{{ story.url }}" class="hover:text-gray-300">
                {{ story.data.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </nav>

      <!-- Right: About + Language Toggle -->
      <div class="flex items-center space-x-4 text-sm">
        <a href="/{{ currentLang }}/about/">
          {% if currentLang == "en" %}About{% else %}Acerca de{% endif %}
        </a>
        
        <!-- Language Toggle -->
        {% if currentLang == "en" %}
          {% set otherLang = "es" %}
        {% else %}
          {% set otherLang = "en" %}
        {% endif %}

        <!-- Find translated URL -->
        {% set translatedUrl = "/" ~ otherLang ~ "/" %}
        
        {% if '/stories/' in page.url %}
          {% set urlSegments = page.url.split('/') %}
          {% set storySlug = urlSegments[urlSegments.length - 1] or urlSegments[urlSegments.length - 2] %}
          {% if storySlug == "" %}
            {% set storySlug = urlSegments[urlSegments.length - 2] %}
          {% endif %}

          <!-- Loop through other language stories to find matching translation key -->
          {% if currentLang == "en" and collections.storiesES.length > 0 %}
            {% set foundMatch = false %}
            {% for story in collections.storiesES %}
              {% if not foundMatch and story.data.translationKey == page.data.translationKey %}
                {% set translatedUrl = story.url %}
                {% set foundMatch = true %}
              {% endif %}
            {% endfor %}
          {% elif currentLang == "es" and collections.storiesEN.length > 0 %}
            {% set foundMatch = false %}
            {% for story in collections.storiesEN %}
              {% if not foundMatch and story.data.translationKey == page.data.translationKey %}
                {% set translatedUrl = story.url %}
                {% set foundMatch = true %}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endif %}

        <div class="language-toggle rounded-full bg-gray-800 p-1 flex items-center">
          {% if currentLang == "en" %}
            <span class="toggle-option active py-1 px-3 rounded-full bg-white text-black font-medium transition-all">EN</span>
            <a href="{{ translatedUrl }}" class="toggle-option py-1 px-3 text-gray-300 hover:text-white transition-colors">ES</a>
          {% else %}
            <a href="{{ translatedUrl }}" class="toggle-option py-1 px-3 text-gray-300 hover:text-white transition-colors">EN</a>
            <span class="toggle-option active py-1 px-3 rounded-full bg-white text-black font-medium transition-all">ES</span>
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <!-- Your main content -->
  <main class="flex-grow bg-white">
    {{ content | safe }}
  </main>
  <footer class="bg-[#8D926E] text-white py-4">
     <div class="max-w-7xl mx-auto flex items-center justify-between px-4">
       <!-- Left: Logo -->
       <div class="font-semibold">Logo</div>
         <ul class="flex space-x-6 text-sm">
           <li><a href="https://instagram.com" target="_blank" rel="noopener">Instagram</a></li>
           <li><a href="https://facebook.com" target="_blank" rel="noopener">Facebook</a></li>
           <li><a href="#">Blog</a></li>
           <li><a href="#" class="font-semibold">About Hussman</a></li>
         </ul>
       </nav>
     </div>
   </footer>
   <script src="/assets/js/lightsOut.js"></script>
</body>
</html>